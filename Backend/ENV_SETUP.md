# Backend Environment Configuration

## Required Environment Variables

### Production (Render)

Set these in Render Dashboard → Your Service → Environment:

#### Essential Variables (Auto-generated by Render)
```bash
NODE_ENV=production
PORT=10000
DATABASE_URL=<provided-by-render>
JWT_ACCESS_SECRET=<auto-generated-32-chars>
JWT_REFRESH_SECRET=<auto-generated-32-chars>
ENCRYPTION_KEY=<auto-generated-32-chars>
```

#### CORS & Frontend
```bash
CORS_ORIGIN=https://your-frontend.vercel.app
FRONTEND_URL=https://your-frontend.vercel.app
```

#### Google OAuth (Optional)
```bash
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
GOOGLE_CALLBACK_URL=https://your-backend.onrender.com/api/auth/google/callback
```

#### Email Configuration (Optional - for invitations)
```bash
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
FROM_EMAIL=your-email@gmail.com
FROM_NAME=Key Vault
```

#### JWT Configuration
```bash
JWT_ACCESS_TTL=15m
JWT_REFRESH_TTL=7d
```

## Local Development Setup

1. Copy `env.example` to `.env`:
```bash
cp env.example .env
```

2. Update `.env` with your local values:
```bash
# Use localhost database
DATABASE_URL=postgresql://keyvault:keyvault@localhost:5432/keyvault

# Generate random secrets (at least 32 characters)
JWT_ACCESS_SECRET=your_local_jwt_access_secret_here_32chars
JWT_REFRESH_SECRET=your_local_jwt_refresh_secret_here_32chars
ENCRYPTION_KEY=your_local_encryption_key_here_32chars

# Local CORS
CORS_ORIGIN=http://localhost:5173
FRONTEND_URL=http://localhost:5173

# Local Google OAuth callback
GOOGLE_CALLBACK_URL=http://localhost:4000/api/auth/google/callback
```

## Generating Secure Secrets

### Using Node.js:
```javascript
// Generate 32-byte random string
require('crypto').randomBytes(32).toString('hex')
```

### Using OpenSSL:
```bash
openssl rand -hex 32
```

### Using Python:
```python
import secrets
secrets.token_hex(32)
```

## Database Migration on Render

Render will automatically run migrations on deploy. If you need to manually run migrations:

```bash
# SSH into your Render service
npx prisma migrate deploy
```

## Environment Variable Priority

1. Render Environment Variables (highest priority)
2. `.env` file
3. Default values in code (if any)

## Security Notes

⚠️ **NEVER** commit `.env` files to Git
⚠️ Use strong, randomly generated secrets for production
⚠️ Rotate secrets regularly
⚠️ Enable HTTPS in production (Render provides this automatically)
⚠️ Set secure cookie settings in production

